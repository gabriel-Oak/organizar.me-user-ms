{"version":3,"file":"index.js","sources":["core/utils/services/database-service/index.ts"],"sourceRoot":"/","sourcesContent":["/* eslint-disable @typescript-eslint/restrict-template-expressions */\nimport { DataSource, Repository } from 'typeorm'\nimport { MONGODB_URI } from '../../constants';\nimport UserSchema from '../../../features/user/schemas/user-schema';\nimport createContainer from '../../decorators/container';\nimport { ILoggerService } from '../logger-service/types';\n\nconst DatabaseService = new DataSource({\n  type: 'mongodb',\n  url: MONGODB_URI,\n  entities: [\n    UserSchema\n  ],\n  synchronize: true\n});\n\nexport const initDB = async () => {\n  if (!DatabaseService.isInitialized) {\n    const logger = createContainer().get<ILoggerService>('ILoggerService');\n    logger.info('Initializing connection with database');\n    await DatabaseService.initialize()\n      .then(() => logger.info('Database initialized successfuly'))\n      .catch((error) => {\n        logger.error('Database initialize error: ', error);\n      });\n  }\n  return DatabaseService.isInitialized;\n};\n\nconst container = createContainer();\n\ncontainer.bind<Repository<UserSchema>>('Repository<UserSchema>')\n  .toDynamicValue(() => DatabaseService.getRepository(UserSchema));\ncontainer.bind<DataSource>('DataSource').toDynamicValue(() => DatabaseService);\ncontainer.bind<() => Promise<boolean>>('initDB').toDynamicValue(() => initDB);\n\nexport default DatabaseService;\n"],"names":[],"mappings":";;;;;;;;AAAA,qEAAqE;AACrE,qCAAgD;AAChD,+CAA8C;AAC9C,6FAAoE;AACpE,2EAAyD;AAGzD,MAAM,eAAe,GAAG,IAAI,oBAAU,CAAC;IACrC,IAAI,EAAE,SAAS;IACf,GAAG,EAAE,uBAAW;IAChB,QAAQ,EAAE;QACR,qBAAU;KACX;IACD,WAAW,EAAE,IAAI;CAClB,CAAC,CAAC;AAEI,MAAM,MAAM,GAAG,KAAK,IAAI,EAAE;IAC/B,IAAI,CAAC,eAAe,CAAC,aAAa,EAAE,CAAC;QACnC,MAAM,MAAM,GAAG,IAAA,mBAAe,GAAE,CAAC,GAAG,CAAiB,gBAAgB,CAAC,CAAC;QACvE,MAAM,CAAC,IAAI,CAAC,uCAAuC,CAAC,CAAC;QACrD,MAAM,eAAe,CAAC,UAAU,EAAE;aAC/B,IAAI,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,kCAAkC,CAAC,CAAC;aAC3D,KAAK,CAAC,CAAC,KAAK,EAAE,EAAE;YACf,MAAM,CAAC,KAAK,CAAC,6BAA6B,EAAE,KAAK,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACP,CAAC;IACD,OAAO,eAAe,CAAC,aAAa,CAAC;AACvC,CAAC,CAAC;AAXW,QAAA,MAAM,UAWjB;AAEF,MAAM,SAAS,GAAG,IAAA,mBAAe,GAAE,CAAC;AAEpC,SAAS,CAAC,IAAI,CAAyB,wBAAwB,CAAC;KAC7D,cAAc,CAAC,GAAG,EAAE,CAAC,eAAe,CAAC,aAAa,CAAC,qBAAU,CAAC,CAAC,CAAC;AACnE,SAAS,CAAC,IAAI,CAAa,YAAY,CAAC,CAAC,cAAc,CAAC,GAAG,EAAE,CAAC,eAAe,CAAC,CAAC;AAC/E,SAAS,CAAC,IAAI,CAAyB,QAAQ,CAAC,CAAC,cAAc,CAAC,GAAG,EAAE,CAAC,cAAM,CAAC,CAAC;AAE9E,kBAAe,eAAe,CAAC","debug_id":"f28e1ff2-a788-571d-ac4c-1138c0f61661"}