{"version":3,"file":"user-model.js","sources":["core/features/user/models/user-model.ts"],"sourceRoot":"/","sourcesContent":["import { BeforeInsert, BeforeUpdate, Column, Entity, ObjectIdColumn, ObjectId } from 'typeorm';\r\nimport { compare, hash } from 'bcryptjs';\r\nimport { JWT_SECRET } from '../../../utils/constants';\r\n\r\nexport interface UserProps {\r\n  id?: ObjectId;\r\n  name: string;\r\n  email: string;\r\n  password?: string;\r\n}\r\n\r\n@Entity('user')\r\nexport default class UserModel implements UserProps {\r\n  @ObjectIdColumn()\r\n  public id?: ObjectId;\r\n\r\n  @Column({\r\n    type: 'text',\r\n    unique: false,\r\n    nullable: false\r\n  })\r\n  public name!: string;\r\n\r\n  @Column({\r\n    type: 'text',\r\n    unique: true\r\n  })\r\n  public email!: string;\r\n\r\n  @Column({\r\n    type: 'text',\r\n    nullable: false\r\n  })\r\n  public password?: string;\r\n\r\n  constructor(props?: UserProps) {\r\n    Object.assign(this, props);\r\n  }\r\n\r\n  @BeforeInsert()\r\n  @BeforeUpdate()\r\n  async hashPassword() {\r\n    if (this.password &&\r\n      !this.password.includes('$2a$12$') &&\r\n      this.password.length < 60\r\n    ) {\r\n      this.password = await hash(this.password + JWT_SECRET, 12);\r\n    }\r\n  }\r\n\r\n  async comparePasswords(candidatePassword: string) {\r\n    if (!this.password) return false;\r\n    return await compare(candidatePassword + JWT_SECRET, this.password);\r\n  }\r\n\r\n  getProps() {\r\n    return {\r\n      id: this.id,\r\n      name: this.name,\r\n      email: this.email\r\n    }\r\n  }\r\n\r\n  updateProps(props: Partial<Omit<UserProps, 'id'>>) {\r\n    Object.assign(this, {\r\n      name: props.name ?? this.name,\r\n      email: props.email ?? this.email\r\n    });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;AAAA,qCAA+F;AAC/F,uCAAyC;AACzC,wDAAsD;AAUvC,IAAM,SAAS,GAAf,MAAM,SAAS;IAuB5B,YAAY,KAAiB;QAC3B,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;IAC7B,CAAC;IAIK,AAAN,KAAK,CAAC,YAAY;QAChB,IAAI,IAAI,CAAC,QAAQ;YACf,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC;YAClC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,EAAE,EACzB,CAAC;YACD,IAAI,CAAC,QAAQ,GAAG,MAAM,IAAA,eAAI,EAAC,IAAI,CAAC,QAAQ,GAAG,sBAAU,EAAE,EAAE,CAAC,CAAC;QAC7D,CAAC;IACH,CAAC;IAED,KAAK,CAAC,gBAAgB,CAAC,iBAAyB;QAC9C,IAAI,CAAC,IAAI,CAAC,QAAQ;YAAE,OAAO,KAAK,CAAC;QACjC,OAAO,MAAM,IAAA,kBAAO,EAAC,iBAAiB,GAAG,sBAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;IACtE,CAAC;IAED,QAAQ;QACN,OAAO;YACL,EAAE,EAAE,IAAI,CAAC,EAAE;YACX,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,KAAK,EAAE,IAAI,CAAC,KAAK;SAClB,CAAA;IACH,CAAC;IAED,WAAW,CAAC,KAAqC;QAC/C,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE;YAClB,IAAI,EAAE,KAAK,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI;YAC7B,KAAK,EAAE,KAAK,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK;SACjC,CAAC,CAAC;IACL,CAAC;CACF,CAAA;AAvDQ;IADN,IAAA,wBAAc,GAAE;8BACL,kBAAQ;qCAAC;AAOd;IALN,IAAA,gBAAM,EAAC;QACN,IAAI,EAAE,MAAM;QACZ,MAAM,EAAE,KAAK;QACb,QAAQ,EAAE,KAAK;KAChB,CAAC;;uCACmB;AAMd;IAJN,IAAA,gBAAM,EAAC;QACN,IAAI,EAAE,MAAM;QACZ,MAAM,EAAE,IAAI;KACb,CAAC;;wCACoB;AAMf;IAJN,IAAA,gBAAM,EAAC;QACN,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,KAAK;KAChB,CAAC;;2CACuB;AAQnB;IAFL,IAAA,sBAAY,GAAE;IACd,IAAA,sBAAY,GAAE;;;;6CAQd;AApCkB,SAAS;IAD7B,IAAA,gBAAM,EAAC,MAAM,CAAC;;GACM,SAAS,CAyD7B;kBAzDoB,SAAS","debug_id":"0da105f0-c150-5112-920c-eb1d7189ff99"}