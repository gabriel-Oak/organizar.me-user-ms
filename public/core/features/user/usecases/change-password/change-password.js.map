{"version":3,"file":"change-password.js","sources":["core/features/user/usecases/change-password/change-password.ts"],"sourceRoot":"/","sourcesContent":["import { inject } from 'inversify';\r\nimport Injectable from '../../../../utils/decorators/injectable';\r\nimport { Left, Right } from '../../../../utils/types';\r\nimport { IInternalUserDatasource } from '../../datasources/internal-datasource/types';\r\nimport { ChangePasswordInvalidOldPassError, ChangePasswordInvalidPassError, ChangePasswordPayload, IChangePasswordUsecase } from './types';\r\n\r\n@Injectable('IChangePasswordUsecase')\r\nexport default class ChangePasswordUsecase implements IChangePasswordUsecase {\r\n  constructor(\r\n    @inject('IInternalUserDatasource')\r\n    private readonly userDatasource: IInternalUserDatasource\r\n  ) {}\r\n\r\n  async execute(payload: ChangePasswordPayload) {\r\n    if (!payload.newPassword || !payload.oldPassword) {\r\n      return new Left(new ChangePasswordInvalidPassError());\r\n    }\r\n\r\n    const userResult = await this.userDatasource.findById(payload.userId);\r\n    if (userResult.isError) return userResult;\r\n    if (!userResult.success) return new Left(new ChangePasswordInvalidPassError());\r\n    const { success: user } = userResult;\r\n\r\n    const oldPassIsValid = await user.comparePasswords(payload.oldPassword);\r\n    if (!oldPassIsValid) return new Left(new ChangePasswordInvalidOldPassError());\r\n\r\n    user.password = payload.newPassword;\r\n    const insertResult = await this.userDatasource.update(user);\r\n    if (insertResult.isError) return insertResult;\r\n\r\n    return new Right('Senha atualizada com sucesso!');\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,yCAAmC;AACnC,yFAAiE;AACjE,mDAAsD;AAEtD,mCAA2I;AAG5H,IAAM,qBAAqB,GAA3B,MAAM,qBAAqB;IACxC,YAEmB,cAAuC;QAAvC,mBAAc,GAAd,cAAc,CAAyB;IACvD,CAAC;IAEJ,KAAK,CAAC,OAAO,CAAC,OAA8B;QAC1C,IAAI,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;YACjD,OAAO,IAAI,YAAI,CAAC,IAAI,sCAA8B,EAAE,CAAC,CAAC;QACxD,CAAC;QAED,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QACtE,IAAI,UAAU,CAAC,OAAO;YAAE,OAAO,UAAU,CAAC;QAC1C,IAAI,CAAC,UAAU,CAAC,OAAO;YAAE,OAAO,IAAI,YAAI,CAAC,IAAI,sCAA8B,EAAE,CAAC,CAAC;QAC/E,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,UAAU,CAAC;QAErC,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QACxE,IAAI,CAAC,cAAc;YAAE,OAAO,IAAI,YAAI,CAAC,IAAI,yCAAiC,EAAE,CAAC,CAAC;QAE9E,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,WAAW,CAAC;QACpC,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC5D,IAAI,YAAY,CAAC,OAAO;YAAE,OAAO,YAAY,CAAC;QAE9C,OAAO,IAAI,aAAK,CAAC,+BAA+B,CAAC,CAAC;IACpD,CAAC;CACF,CAAA;AAzBoB,qBAAqB;IADzC,IAAA,oBAAU,EAAC,wBAAwB,CAAC;IAGhC,WAAA,IAAA,kBAAM,EAAC,yBAAyB,CAAC,CAAA;;GAFjB,qBAAqB,CAyBzC;kBAzBoB,qBAAqB","debug_id":"d4e7233b-ac18-5f1e-b177-f2040d9873c8"}