{"version":3,"file":"change-password.js","sources":["core/features/user/usecases/change-password/change-password.ts"],"sourceRoot":"/","sourcesContent":["import { inject } from 'inversify';\nimport Injectable from '../../../../utils/decorators/injectable';\nimport { Left, Right } from '../../../../utils/types';\nimport { IInternalUserDatasource } from '../../datasources/internal-datasource/types';\nimport { ChangePasswordInvalidOldPassError, ChangePasswordInvalidPassError, ChangePasswordPayload, IChangePasswordUsecase } from './types';\nimport { ObjectId } from 'mongodb';\n\n@Injectable('IChangePasswordUsecase')\nexport default class ChangePasswordUsecase implements IChangePasswordUsecase {\n  constructor(\n    @inject('IInternalUserDatasource')\n    private readonly userDatasource: IInternalUserDatasource\n  ) { }\n\n  async execute(payload: ChangePasswordPayload) {\n    if (!payload.newPassword || !payload.oldPassword) {\n      return new Left(new ChangePasswordInvalidPassError());\n    }\n\n    const userResult = await this.userDatasource.findById(new ObjectId(payload.userId));\n    if (userResult.isError) return userResult;\n    if (!userResult.success) return new Left(new ChangePasswordInvalidPassError());\n    const { success: user } = userResult;\n\n    const oldPassIsValid = await user.comparePasswords(payload.oldPassword);\n    if (!oldPassIsValid) return new Left(new ChangePasswordInvalidOldPassError());\n\n    user.password = payload.newPassword;\n    await user.hashPassword();\n    const insertResult = await this.userDatasource.update(user);\n    if (insertResult.isError) return insertResult;\n\n    return new Right('Senha atualizada com sucesso!');\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,yCAAmC;AACnC,yFAAiE;AACjE,mDAAsD;AAEtD,mCAA2I;AAC3I,qCAAmC;AAGpB,IAAM,qBAAqB,GAA3B,MAAM,qBAAqB;IACxC,YAEmB,cAAuC;QAAvC,mBAAc,GAAd,cAAc,CAAyB;IACtD,CAAC;IAEL,KAAK,CAAC,OAAO,CAAC,OAA8B;QAC1C,IAAI,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;YACjD,OAAO,IAAI,YAAI,CAAC,IAAI,sCAA8B,EAAE,CAAC,CAAC;QACxD,CAAC;QAED,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI,kBAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;QACpF,IAAI,UAAU,CAAC,OAAO;YAAE,OAAO,UAAU,CAAC;QAC1C,IAAI,CAAC,UAAU,CAAC,OAAO;YAAE,OAAO,IAAI,YAAI,CAAC,IAAI,sCAA8B,EAAE,CAAC,CAAC;QAC/E,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,UAAU,CAAC;QAErC,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QACxE,IAAI,CAAC,cAAc;YAAE,OAAO,IAAI,YAAI,CAAC,IAAI,yCAAiC,EAAE,CAAC,CAAC;QAE9E,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,WAAW,CAAC;QACpC,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;QAC1B,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC5D,IAAI,YAAY,CAAC,OAAO;YAAE,OAAO,YAAY,CAAC;QAE9C,OAAO,IAAI,aAAK,CAAC,+BAA+B,CAAC,CAAC;IACpD,CAAC;CACF,CAAA;AA1BoB,qBAAqB;IADzC,IAAA,oBAAU,EAAC,wBAAwB,CAAC;IAGhC,WAAA,IAAA,kBAAM,EAAC,yBAAyB,CAAC,CAAA;;GAFjB,qBAAqB,CA0BzC;kBA1BoB,qBAAqB","debug_id":"6f7af8b3-94ff-5881-9c32-f76f7bc12222"}