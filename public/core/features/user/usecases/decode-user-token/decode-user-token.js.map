{"version":3,"file":"decode-user-token.js","sources":["core/features/user/usecases/decode-user-token/decode-user-token.ts"],"sourceRoot":"/","sourcesContent":["import { Either, Left } from '../../../../utils/types';\nimport { IInternalUserDatasource } from '../../datasources/internal-datasource/types';\nimport { DecodeUserInvalidTokenError, DecodeUserNotFoundError, decodeUserTokenErrors, IDecodeUserTokenUsecase } from './types';\nimport jwt from 'jsonwebtoken';\nimport { JWT_SECRET } from '../../../../utils/constants';\nimport Injectable from '../../../../utils/decorators/injectable';\nimport { inject } from 'inversify';\nimport User, { UserProps } from '../../entities/user';\n\n@Injectable('IDecodeUserTokenUsecase')\nexport default class DecodeUserTokenUsecase implements IDecodeUserTokenUsecase {\n  constructor(\n    @inject('IInternalUserDatasource')\n    private readonly userDatasource: IInternalUserDatasource\n  ) { }\n\n  async execute(token: string) {\n    try {\n      const decodedUser = jwt.verify(token, JWT_SECRET) as Omit<UserProps, 'id'> & { id: string };\n      const userResult = await this.userDatasource.findById(decodedUser.id);\n\n      if (userResult.isError || userResult.success) {\n        return userResult as unknown as Either<decodeUserTokenErrors, User>;\n      }\n\n      return new Left(new DecodeUserNotFoundError());\n    } catch (_) {\n      return new Left(new DecodeUserInvalidTokenError());\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,mDAAuD;AAEvD,mCAA+H;AAC/H,gEAA+B;AAC/B,2DAAyD;AACzD,yFAAiE;AACjE,yCAAmC;AAIpB,IAAM,sBAAsB,GAA5B,MAAM,sBAAsB;IACzC,YAEmB,cAAuC;QAAvC,mBAAc,GAAd,cAAc,CAAyB;IACtD,CAAC;IAEL,KAAK,CAAC,OAAO,CAAC,KAAa;QACzB,IAAI,CAAC;YACH,MAAM,WAAW,GAAG,sBAAG,CAAC,MAAM,CAAC,KAAK,EAAE,sBAAU,CAA2C,CAAC;YAC5F,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;YAEtE,IAAI,UAAU,CAAC,OAAO,IAAI,UAAU,CAAC,OAAO,EAAE,CAAC;gBAC7C,OAAO,UAA4D,CAAC;YACtE,CAAC;YAED,OAAO,IAAI,YAAI,CAAC,IAAI,+BAAuB,EAAE,CAAC,CAAC;QACjD,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,IAAI,YAAI,CAAC,IAAI,mCAA2B,EAAE,CAAC,CAAC;QACrD,CAAC;IACH,CAAC;CACF,CAAA;AApBoB,sBAAsB;IAD1C,IAAA,oBAAU,EAAC,yBAAyB,CAAC;IAGjC,WAAA,IAAA,kBAAM,EAAC,yBAAyB,CAAC,CAAA;;GAFjB,sBAAsB,CAoB1C;kBApBoB,sBAAsB","debug_id":"eeda2df8-00b7-5339-850d-c55747f11b6b"}