{"version":3,"file":"decode-user-token.js","sources":["core/features/user/usecases/decode-user-token/decode-user-token.ts"],"sourceRoot":"/","sourcesContent":["import { Either, Left } from '../../../../utils/types';\r\nimport { IInternalUserDatasource } from '../../datasources/internal-datasource/types';\r\nimport UserModel, { UserProps } from '../../models/user-model';\r\nimport { DecodeUserInvalidTokenError, DecodeUserNotFoundError, decodeUserTokenErrors, IDecodeUserTokenUsecase } from './types';\r\nimport jwt from 'jsonwebtoken';\r\nimport { JWT_SECRET } from '../../../../utils/constants';\r\nimport Injectable from '../../../../utils/decorators/injectable';\r\nimport { inject } from 'inversify';\r\n\r\n@Injectable('IDecodeUserTokenUsecase')\r\nexport default class DecodeUserTokenUsecase implements IDecodeUserTokenUsecase {\r\n  constructor(\r\n    @inject('IInternalUserDatasource')\r\n    private readonly userDatasource: IInternalUserDatasource\r\n  ) {}\r\n\r\n  async execute(token: string) {\r\n    try {\r\n      const decodedUser = jwt.verify(token, JWT_SECRET) as UserProps;\r\n      const userResult = await this.userDatasource.findById(decodedUser.id!);\r\n      if (userResult.isError || userResult.success) {\r\n        return userResult as unknown as Either<decodeUserTokenErrors, UserModel>;\r\n      }\r\n\r\n      return new Left(new DecodeUserNotFoundError());\r\n    } catch (_) {\r\n      return new Left(new DecodeUserInvalidTokenError());\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,mDAAuD;AAGvD,mCAA+H;AAC/H,gEAA+B;AAC/B,2DAAyD;AACzD,yFAAiE;AACjE,yCAAmC;AAGpB,IAAM,sBAAsB,GAA5B,MAAM,sBAAsB;IACzC,YAEmB,cAAuC;QAAvC,mBAAc,GAAd,cAAc,CAAyB;IACvD,CAAC;IAEJ,KAAK,CAAC,OAAO,CAAC,KAAa;QACzB,IAAI,CAAC;YACH,MAAM,WAAW,GAAG,sBAAG,CAAC,MAAM,CAAC,KAAK,EAAE,sBAAU,CAAc,CAAC;YAC/D,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAG,CAAC,CAAC;YACvE,IAAI,UAAU,CAAC,OAAO,IAAI,UAAU,CAAC,OAAO,EAAE,CAAC;gBAC7C,OAAO,UAAiE,CAAC;YAC3E,CAAC;YAED,OAAO,IAAI,YAAI,CAAC,IAAI,+BAAuB,EAAE,CAAC,CAAC;QACjD,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,IAAI,YAAI,CAAC,IAAI,mCAA2B,EAAE,CAAC,CAAC;QACrD,CAAC;IACH,CAAC;CACF,CAAA;AAnBoB,sBAAsB;IAD1C,IAAA,oBAAU,EAAC,yBAAyB,CAAC;IAGjC,WAAA,IAAA,kBAAM,EAAC,yBAAyB,CAAC,CAAA;;GAFjB,sBAAsB,CAmB1C;kBAnBoB,sBAAsB","debug_id":"3a589785-b815-5ea6-bffb-d25f8d773d7e"}