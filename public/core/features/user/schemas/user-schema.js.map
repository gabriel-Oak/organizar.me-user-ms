{"version":3,"file":"user-schema.js","sources":["core/features/user/schemas/user-schema.ts"],"sourceRoot":"/","sourcesContent":["import { BeforeInsert, BeforeUpdate, Column, Entity, ObjectIdColumn, ObjectId } from 'typeorm';\nimport { compare, hash } from 'bcryptjs';\nimport { JWT_SECRET } from '../../../utils/constants';\n\nexport interface UserSchemaProps {\n  id?: ObjectId;\n  name: string;\n  email: string;\n  password?: string;\n}\n\n@Entity('user')\nexport default class UserSchema implements UserSchemaProps {\n  @ObjectIdColumn()\n  public id?: ObjectId;\n\n  @Column({\n    type: 'text',\n    unique: false,\n    nullable: false\n  })\n  public name!: string;\n\n  @Column({\n    type: 'text',\n    unique: true\n  })\n  public email!: string;\n\n  @Column({\n    type: 'text',\n    nullable: false\n  })\n  public password?: string;\n\n  constructor(props?: UserSchemaProps) {\n    Object.assign(this, props);\n  }\n\n  @BeforeInsert()\n  @BeforeUpdate()\n  async hashPassword() {\n    if (this.password &&\n      !this.password.includes('$2a$12$') &&\n      this.password.length < 60\n    ) {\n      this.password = await hash(this.password + JWT_SECRET, 12);\n    }\n  }\n\n  async comparePasswords(candidatePassword: string) {\n    if (!this.password) return false;\n    return await compare(candidatePassword + JWT_SECRET, this.password);\n  }\n\n  getProps() {\n    return {\n      id: this.id?.toString(),\n      name: this.name,\n      email: this.email,\n      password: this.password\n    }\n  }\n\n  updateProps(props: Partial<Omit<UserSchemaProps, 'id'>>) {\n    Object.assign(this, {\n      name: props.name ?? this.name,\n      email: props.email ?? this.email\n    });\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;AAAA,qCAA+F;AAC/F,uCAAyC;AACzC,wDAAsD;AAUvC,IAAM,UAAU,GAAhB,MAAM,UAAU;IAuB7B,YAAY,KAAuB;QACjC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;IAC7B,CAAC;IAIK,AAAN,KAAK,CAAC,YAAY;QAChB,IAAI,IAAI,CAAC,QAAQ;YACf,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC;YAClC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,EAAE,EACzB,CAAC;YACD,IAAI,CAAC,QAAQ,GAAG,MAAM,IAAA,eAAI,EAAC,IAAI,CAAC,QAAQ,GAAG,sBAAU,EAAE,EAAE,CAAC,CAAC;QAC7D,CAAC;IACH,CAAC;IAED,KAAK,CAAC,gBAAgB,CAAC,iBAAyB;QAC9C,IAAI,CAAC,IAAI,CAAC,QAAQ;YAAE,OAAO,KAAK,CAAC;QACjC,OAAO,MAAM,IAAA,kBAAO,EAAC,iBAAiB,GAAG,sBAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;IACtE,CAAC;IAED,QAAQ;QACN,OAAO;YACL,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,QAAQ,EAAE;YACvB,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,QAAQ,EAAE,IAAI,CAAC,QAAQ;SACxB,CAAA;IACH,CAAC;IAED,WAAW,CAAC,KAA2C;QACrD,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE;YAClB,IAAI,EAAE,KAAK,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI;YAC7B,KAAK,EAAE,KAAK,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK;SACjC,CAAC,CAAC;IACL,CAAC;CACF,CAAA;AAxDQ;IADN,IAAA,wBAAc,GAAE;8BACL,kBAAQ;sCAAC;AAOd;IALN,IAAA,gBAAM,EAAC;QACN,IAAI,EAAE,MAAM;QACZ,MAAM,EAAE,KAAK;QACb,QAAQ,EAAE,KAAK;KAChB,CAAC;;wCACmB;AAMd;IAJN,IAAA,gBAAM,EAAC;QACN,IAAI,EAAE,MAAM;QACZ,MAAM,EAAE,IAAI;KACb,CAAC;;yCACoB;AAMf;IAJN,IAAA,gBAAM,EAAC;QACN,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,KAAK;KAChB,CAAC;;4CACuB;AAQnB;IAFL,IAAA,sBAAY,GAAE;IACd,IAAA,sBAAY,GAAE;;;;8CAQd;AApCkB,UAAU;IAD9B,IAAA,gBAAM,EAAC,MAAM,CAAC;;GACM,UAAU,CA0D9B;kBA1DoB,UAAU","debug_id":"1b793314-dc90-5453-95bc-02b03d9c755e"}